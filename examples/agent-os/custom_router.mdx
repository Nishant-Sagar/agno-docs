---
title: "AgentOS with Custom Routers"
description: "Complete AgentOS setup with custom FastAPI app and router"
---

## Code

```python cookbook/agent_os/custom_routers.py

from fastapi import FastAPI, APIRouter

from agno.agent import Agent
from agno.db.postgres import PostgresDb
from agno.models.anthropic import Claude
from agno.os import AgentOS
from agno.tools.duckduckgo import DuckDuckGoTools

# Setup the database
db = PostgresDb(db_url="postgresql+psycopg://ai:ai@localhost:5532/ai")

# Setup basic agents, teams and workflows
web_research_agent = Agent(
    name="Web Research Agent",
    model=Claude(id="claude-sonnet-4-0"),
    db=db,
    tools=[DuckDuckGoTools()],
    add_history_to_context=True,
    num_history_runs=3,
    add_datetime_to_context=True,
    markdown=True,
)

# Your own FastAPI app
custom_app = FastAPI()
router = APIRouter()

@router.post("/customers")  
async def get_customers():
    return [
        {
            "id": 1,
            "name": "John Doe",
            "email": "john.doe@example.com",
        },
        {
            "id": 2,
            "name": "Jane Doe",
            "email": "jane.doe@example.com",
        },
    ]

custom_app.include_router(router)  # Include the custom router in the FastAPI app


# Setup our AgentOS app
agent_os = AgentOS(
    description="Example app with custom routers",
    agents=[web_research_agent],
    fastapi_app=custom_app,  # Pass the FastAPI app with the custom router
)
app = agent_os.get_app()


if __name__ == "__main__":
    """Run our AgentOS.

    You can see the docs at:
    http://localhost:7777/docs

    """
    agent_os.serve(app="custom_routers:app", reload=True)

```

## Usage

<Steps>
  <Snippet file="create-venv-step.mdx" />

  <Step title="Set Environment Variables">
    ```bash
    export ANTHROPIC_API_KEY=your_anthropic_api_key
    export DATABASE_URL=postgresql+psycopg://ai:ai@localhost:5532/ai  # Optional
    ```
  </Step>

  <Step title="Install libraries">
    ```bash
    pip install -U agno anthropic fastapi uvicorn sqlalchemy pgvector psycopg
    ```
  </Step>

  <Step title="Setup PostgreSQL Database">
    ```bash
    # Using Docker
    docker run -d \
      --name agno-postgres \
      -e POSTGRES_DB=ai \
      -e POSTGRES_USER=ai \
      -e POSTGRES_PASSWORD=ai \
      -p 5532:5432 \
      pgvector/pgvector:pg17
    ```
  </Step>

  <Step title="Run Example">
    <CodeGroup>
    ```bash Mac
    python cookbook/agent_os/custom_routers.py
    ```

    ```bash Windows
    python cookbook/agent_os/custom_routers.py
    ```
    </CodeGroup>
  </Step>
</Steps>
